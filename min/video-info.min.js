(()=>(i,t)=>{function e(i,t,e){if(t in i){Object.defineProperty(i,t,{value:e,enumerable:true,configurable:true,writable:true})}else{i[t]=e}return i}class s{constructor(i){e(this,"aid",void 0);e(this,"cid",void 0);e(this,"pageCount",void 0);e(this,"coverUrl",void 0);e(this,"tagId",void 0);e(this,"tagName",void 0);e(this,"title",void 0);e(this,"description",void 0);e(this,"up",void 0);e(this,"pages",void 0);e(this,"danmaku",void 0);e(this,"subtitles",void 0);this.aid=i}async fetchInfo(){let i;if(this.cid){i=`https://api.bilibili.com/x/web-interface/view?aid=${this.aid}&cid=${this.cid}`}else{i=`https://api.bilibili.com/x/web-interface/view?aid=${this.aid}`}const t=JSON.parse(await Ajax.getText(i));if(t.code!==0){throw new Error(`${t.message}: aid = ${this.aid}, cid = ${this.cid}, url = ${document.URL}`)}const e=t.data;this.cid=e.cid;this.pageCount=e.videos;this.coverUrl=e.pic.replace("http:","https:");this.tagId=e.tid;this.tagName=e.tname;this.title=e.title;this.description=e.desc;this.up={uid:e.owner.mid,name:e.owner.name,faceUrl:e.owner.face.replace("http:","https:")};this.pages=e.pages.map((i=>({cid:i.cid,title:i.part,pageNumber:i.page})));this.subtitles=e.subtitle.list.map((i=>({id:i.id,languageCode:i.lan,language:i.lan_doc,url:i.subtitle_url.replace("http:","https:")})));return this}async fetchDanmaku(){this.danmaku=new o(this.cid.toString());return this.danmaku.fetchInfo()}}class a{constructor(i,t){e(this,"text",void 0);e(this,"p",void 0);this.text=i;this.p=t}}class o{constructor(i){this.cid=i;e(this,"rawXML",void 0)}async fetchInfo(){const i=await Ajax.getText(`https://api.bilibili.com/x/v1/dm/list.so?oid=${this.cid}`);this.rawXML=i}}class d{constructor(i){e(this,"ep",void 0);e(this,"videos",void 0);e(this,"title",void 0);e(this,"cover",void 0);e(this,"squareCover",void 0);e(this,"aid",void 0);e(this,"cid",void 0);this.ep=i;this.videos=[]}async fetchInfo(){const i=await Ajax.getText(`https://www.bilibili.com/bangumi/play/ep${this.ep}/`);const t=JSON.parse(i.match(/window\.__INITIAL_STATE__=(.*);\(function\(\){/)[1]);this.title=t.mediaInfo.title;this.cover=t.mediaInfo.cover;this.squareCover=t.mediaInfo.square_cover;this.aid=t.epInfo.aid;this.cid=t.epInfo.cid;this.videos=t.epList.map((async i=>({title:i.index_title,aid:i.aid,cid:i.cid,info:await new s(i.aid).fetchInfo()})));return this}}return{export:{VideoInfo:s,BangumiInfo:d,Danmaku:a,DanmakuInfo:o}}})();