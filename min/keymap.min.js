(()=>(e,i)=>{const t=["https://www.bilibili.com/bangumi/","https://www.bilibili.com/video/","https://www.bilibili.com/watchlater/","https://www.bilibili.com/medialist/play/"];let n=true;(async()=>{const{VideoSpeedController:a}=await i.importAsync("default-video-speed");if(t.some((e=>document.URL.startsWith(e)))){const t={f:".bilibili-player-video-fullscreen",w:".bilibili-player-video-web-fullscreen",t:".bilibili-player-video-btn-widescreen",m:".bilibili-player-video-btn-volume .bilibili-player-iconfont-volume",p:".bilibili-player-video-btn-pip",c:".video-toolbar .coin,.tool-bar .coin-info, .video-toolbar-module .coin-box, .play-options-ul > li:nth-child(2)",s:".video-toolbar .collect, .video-toolbar-module .fav-box, .play-options-ul > li:nth-child(3)"," ":".bilibili-player-video-btn-start"};let o=true;let l=false;const s=document.URL.startsWith("https://www.bilibili.com/watchlater/");const c=document.URL.startsWith("https://www.bilibili.com/medialist/play/");if(s){Observer.videoChange((()=>{Ajax.getJsonWithCredentials(`https://api.bilibili.com/x/web-interface/archive/has/like?aid=${unsafeWindow.aid}`).then((e=>{l=Boolean(e.data)}))}))}let r;const p=e=>{let t=dq(".keymap-playback-tip");if(!t){const e=dq(".bilibili-player-video-wrap");if(!e){return}e.insertAdjacentHTML("afterbegin",`\n<div class="keymap-playback-tip-container">\n<i class="mdi mdi-fast-forward"></i>\n<div class="keymap-playback-tip"></div>x\n</div>\n`);i.applyStyleFromText(`\n        .keymap-playback-tip-container {\n          position: absolute;\n          left: 50%;\n          top: 50%;\n          transform: translate(-50%, -50%);\n          padding: 8px 16px;\n          background-color: #000A;\n          color: white;\n          pointer-events: none;\n          opacity: 0;\n          z-index: 100;\n          display: flex;\n          align-items: center;\n          font-size: 14pt;\n          border-radius: 4px;\n          transition: .2s ease-out;\n        }\n        .keymap-playback-tip-container.show {\n          opacity: 1;\n        }\n        .keymap-playback-tip-container i {\n          line-height: 1;\n          margin-right: 8px;\n          font-size: 18pt;\n        }\n`,"keymapStyle");t=dq(".keymap-playback-tip")}t.innerHTML=e.toString();if(r){clearTimeout(r)}dq(".keymap-playback-tip-container").classList.add("show");r=window.setTimeout((()=>{dq(".keymap-playback-tip-container").classList.remove("show")}),2e3)};document.body.addEventListener("keydown",(async i=>{if(!n){return}if(s&&document.URL.endsWith("list")){return}if(document.activeElement&&isTyping()){return}const r=i.key.toLowerCase();const d=dq(".bilibili-player-sphere-control");if(d!==null&&d.style.display!=="none"&&["w","a","s","d"].includes(r)){return}const b=!i.shiftKey&&!i.altKey&&!i.ctrlKey&&!i.metaKey;if(r in t&&b){const e=dq(t[r]);if(!e){return}i.stopPropagation();i.preventDefault();e.click()}else if(r==="d"&&b){const e=dq(".bilibili-player-video-danmaku-switch input");if(!e){return}i.stopPropagation();i.preventDefault();e.checked=!e.checked;raiseEvent(e,"change")}else if(r==="j"&&b){const t=dq(".bilibili-player-video video");t.currentTime+=e.keymapJumpSeconds;i.stopPropagation();i.preventDefault()}else if(r==="l"&&b){if(s){const e={aid:unsafeWindow.aid,like:l?2:1,csrf:getCsrf()};Ajax.postTextWithCredentials(`https://api.bilibili.com/x/web-interface/archive/like`,Object.entries(e).map((([e,i])=>`${e}=${i}`)).join("&")).then((()=>{l=!l;if(l){Toast.success(`已点赞`,`快捷键扩展`,1e3)}else{Toast.success(`已取消点赞`,`快捷键扩展`,1e3)}}))}else if(c){const e=dq(".play-options-ul > li:first-child");if(e){e.click()}}else{const e=dq(".video-toolbar .like");i.preventDefault();const t=(i,t)=>{const n=new CustomEvent(i,t);e.dispatchEvent(n)};o=true;setTimeout((()=>o=false),200);t("mousedown",i);document.body.addEventListener("keyup",(e=>{e.preventDefault();t("mouseup",e);if(o){t("click",e)}}),{once:true})}}else if(r==="`"&&b){const e=dq(".bilibili-player-video-wrap");const i=e.getBoundingClientRect();e.dispatchEvent(new MouseEvent("contextmenu",{bubbles:true,cancelable:false,view:unsafeWindow,button:2,buttons:0,clientX:i.x+i.width/2-176.65/2,clientY:i.y+i.height/2-194/2}))}else if(i.shiftKey){const t=await SpinQuery.select(`.${a.classNameMap.speedContainer}`);const n=await SpinQuery.select(`.${a.classNameMap.video} video`);const o=new a(t,n,1);const l=a.supportedRates;let s=true;if(r===">"||r==="ArrowUp".toLowerCase()){o.setVideoSpeed(l.find((e=>e>o.playbackRate))||l[l.length-1]);p(o.playbackRate)}else if(r==="<"||r==="ArrowDown".toLowerCase()){o.setVideoSpeed([...l].reverse().find((e=>e<o.playbackRate))||l[0]);p(o.playbackRate)}else if(r==="?"){o.reset();p(o.playbackRate)}else if(r==="w"){const e=dq(".video-toolbar .ops .watchlater, .more-ops-list .ops-watch-later, .video-toolbar-module .see-later-box");if(e!==null){e.click()}}else if(r==="j"){n.currentTime-=e.keymapJumpSeconds}else if(r==="s"){const e=dq(".quick-favorite");if(e){e.click()}}else{s=false}if(s){i.stopPropagation();i.preventDefault()}}}))}})();return{reload:()=>n=true,unload:()=>n=false}})();