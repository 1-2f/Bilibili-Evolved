(()=>(e,a)=>{(async()=>{const{forEachFeedsCard:e,addMenuItem:t}=await a.importAsync("feeds-apis");const n=e=>{t(e,{className:"image-export",text:"导出图片",action:async()=>{var t;const n=[];dqa(e.element,".main-content img, .main-content .img-content").forEach((e=>{const a=retrieveImageUrl(e);if(a&&!n.some((({url:e})=>e===a.url))){n.push(a)}}));if(n.length===0){Toast.info("此条动态没有检测到任何图片.","动态图片导出");return}let o;let i=window.setTimeout((()=>{o=Toast.info("下载中...","动态图片导出")}),500);const{DownloadPackage:s}=await a.importAsync("download-package");const c=await Promise.all(n.map((({url:e})=>Ajax.getBlob(e))));const d=new s;c.forEach(((a,t)=>d.add(`${e.username}-${e.id}-${t}${n[t].extension}`,a)));clearTimeout(i);(t=o)===null||t===void 0?void 0:t.dismiss();await d.emit(`${e.username}-${e.id}.zip`)}})};e({added:n})})()})();