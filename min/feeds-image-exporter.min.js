(()=>{return(a,e)=>{(async()=>{const{forEachFeedsCard:a,addMenuItem:t}=await e.importAsync("feeds-apis");const n=a=>{t(a,{className:"image-export",text:"导出图片",action:async()=>{const t=[];dqa(a.element,"img, .img-content").forEach(a=>{const e=retrieveImageUrl(a);if(e){t.push(e)}});if(t.length===0){Toast.info("此条动态没有检测到任何图片.","动态图片导出");return}const{DownloadVideoPackage:n}=await e.importAsync("download-video-package");const o=await Promise.all(t.map(({url:a})=>Ajax.getBlob(a)));const i=new n;o.forEach((e,n)=>i.add(`${a.username}-${a.id}-${n}${t[n].extension}`,e));await i.emit(`${a.username}-${a.id}.zip`)}})};a({added:n})})()}})();